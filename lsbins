#!/usr/bin/perl

#----------------------------------------------------------------------------------
# Project Name      - PerlProjects/lsbins
# Started On        - Thu 25 Apr 14:17:05 BST 2019
# Last Change       - Thu  9 May 16:11:13 BST 2019
# Author E-Mail     - terminalforlife@yahoo.com
# Author GitHub     - https://github.com/terminalforlife
#----------------------------------------------------------------------------------

use strict;
use warnings;
use autodie;
use File::Basename 'basename';
use List::MoreUtils 'uniq';
use TFL; # <-- libtfl-perl (>= 2019-05-07)

my $_VERSION_ = "2019-05-09";
my $_PROJECT_ = basename($0);

while($ARGV[0]){
	if($ARGV[0] =~ /^(--help|-h|-\?)$/){
		print("USAGE: lsbins [[--help|-h|-?] | [--version|-v]]\n");
		exit(0)
	}elsif($ARGV[0] =~ /^(--version|-v)$/){
		print("$_VERSION_\n"); exit 0
	}elsif($ARGV[0] =~ /^-.*/){
		TFL::FAIL(1, __LINE__, "Incorrect argument(s) specified")
	}else{
		last
	}

	shift(@ARGV)
}

TFL::DepChk('/usr/bin/man');

my @EXECS;
foreach(split(':', $ENV{PATH})){
	foreach(glob("$_/*")){
		if(-f $_ and -x $_ and -r $_){
			push(@EXECS, basename($_, '/'))
		}
	}
}

@EXECS = uniq(sort({lc($a) cmp lc($b)} @EXECS));

my @MANS;
if(-d '/usr/share/man'){
	@MANS = glob('/usr/share/man/man[1-8]/*.[1-8].gz')
}else{
	TFL::FAIL(1, __LINE__, "Unable to find the man pages.")
}

# I really don't want to do this, but any method I try with Perl is very slow.
print(readpipe("/usr/bin/man -f @EXECS 2> /dev/null") =~ s/\([0-8]\)\s+//gr);
